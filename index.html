<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consulta de Ativos Veterinários — Biovetfarma</title>
  <meta name="description" content="Pesquisa de ativos para prescrição veterinária com indicações e calculadora de dosagem." />
  <style>
    :root{
      --bf-teal-escuro:#1A7175; --bf-teal:#3CB3C0; --bf-verde-claro:#CFF9B9;
      --bf-verde:#9FD983; --bf-verde-medio:#84C165; --bf-creme:#FEFED3;
      --bf-creme-escuro:#D6D37F; --bf-preto:#000000;
      --bg: var(--bf-creme); --surface: #ffffff; --text: #0f172a;
      --primary: var(--bf-teal-escuro); --primary-2: var(--bf-teal);
      --ok: var(--bf-verde-medio); --muted: #64748b; --ring: rgba(28,140,144,0.25);
      --shadow: 0 8px 30px rgba(2,7,22,0.08); --radius: 16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Arial,Helvetica,sans-serif;color:var(--text);
      background:linear-gradient(180deg,var(--bg),#ffffff 60%)}
    header{padding:28px 18px 10px;text-align:center;}
    .brand{display:inline-flex;align-items:center;gap:12px;justify-content:center;
      font-weight:700;color:var(--primary);}
    .brand .logo{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,var(--primary-2),var(--primary));display:inline-block;}
    .container{max-width:920px;margin:0 auto;padding:18px;}
    .search-card{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;border:1px solid rgba(0,0,0,0.04);}
    .search-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .search-row input[type="search"]{flex:1 1 360px;padding:14px 16px;border-radius:12px;border:1px solid #e2e8f0;font-size:16px;outline:none;transition:box-shadow .2s,border-color .2s;background:#fff;}
    .search-row input[type="search"]:focus{border-color:var(--primary-2);box-shadow:0 0 0 4px var(--ring);}
    .btn{appearance:none;border:0;border-radius:12px;padding:14px 18px;font-weight:600;cursor:pointer;font-size:16px;background:var(--primary);color:white;box-shadow:0 6px 16px rgba(26,113,117,.18);transition:transform .04s ease,filter .2s ease;}
    .btn:hover{filter:brightness(1.05)}.btn:active{transform:translateY(1px)}
    .hint{color:var(--muted);font-size:14px;margin-top:10px}
    .results{margin-top:18px}
    .drug-card{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;border:1px solid rgba(0,0,0,0.04);}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;background:rgba(60,179,192,0.12);color:var(--primary);}
    h1{font-size:22px;margin:10px 0 2px}h2{font-size:18px;margin:0 0 10px;color:var(--primary)}
    h3{font-size:16px;margin:16px 0 8px;color:#0b3b3d}p{margin:6px 0 10px;line-height:1.5}
    .grid{display:grid;gap:14px;grid-template-columns:1fr;}
    @media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr;gap:16px}}
    .calc{background:linear-gradient(180deg,var(--bf-verde-claro),#fff 90%);
      border-radius:12px;padding:14px;border:1px solid #dbece0;}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .row input[type="number"], .row select{padding:12px;border-radius:10px;border:1px solid #e2e8f0;font-size:16px;outline:none;}
    .row select{background:#fff;min-width:110px}
    .row input[type="number"]{width:140px;}
    .row input[type="number"]:focus{border-color:var(--primary-2);box-shadow:0 0 0 4px var(--ring)}
    .row select:focus{border-color:var(--primary-2);box-shadow:0 0 0 4px var(--ring)}
    .row .dose-input{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .input-error{border-color:#f97316!important;box-shadow:0 0 0 4px rgba(249,115,22,0.3)!important;}
    .dose{margin-top:8px;padding:10px 12px;background:#fff;border:1px dashed #cbd5e1;border-radius:10px;font-size:15px;}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .btn-ghost{background:#fff;color:var(--primary);border:1px solid var(--primary);box-shadow:none;}
    .callout{margin-top:10px;background:linear-gradient(90deg,#fff,var(--bf-creme));
      border:1px solid #efecc6;border-radius:12px;padding:10px 12px;font-size:14px;color:#4b5563;}
    .empty{margin-top:16px;padding:22px;border:1px dashed #e2e8f0;border-radius:12px;background:#fff;color:#475569;text-align:center;}
    footer{text-align:center;font-size:12px;color:#94a3b8;padding:24px 12px 36px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:6px;padding:2px 6px}
    .cart-trigger{margin-top:12px;background:#fff;color:var(--primary);border:1px solid rgba(26,113,117,0.25);box-shadow:none;padding:10px 16px;font-size:15px;display:inline-flex;align-items:center;gap:8px;}
    .badge{display:inline-flex;align-items:center;justify-content:center;min-width:24px;height:24px;padding:0 6px;border-radius:999px;background:var(--primary);color:#fff;font-size:13px;font-weight:600;}
    .modal{position:fixed;inset:0;background:rgba(15,23,42,0.38);display:none;align-items:center;justify-content:center;padding:20px;z-index:40;}
    .modal.open{display:flex;}
    .modal-card{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(15,23,42,0.18);max-width:640px;width:100%;max-height:90vh;display:flex;flex-direction:column;overflow:hidden;}
    .modal-header{padding:22px 24px;border-bottom:1px solid #e2e8f0;display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap;}
    .modal-header h2{margin:0;font-size:20px;color:var(--primary);}
    .modal-close{background:none;border:0;color:#475569;font-size:14px;font-weight:600;cursor:pointer;padding:6px 10px;border-radius:8px;}
    .modal-close:hover{background:#f1f5f9;}
    .modal-body{padding:20px 24px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;}
    .modal-body label{font-size:14px;font-weight:600;color:#334155;margin-bottom:4px;display:block;}
    .modal-body input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #e2e8f0;font-size:15px;}
    .modal-body input[type="text"]:focus{border-color:var(--primary-2);box-shadow:0 0 0 4px var(--ring);outline:none;}
    .cart-items{display:flex;flex-direction:column;gap:12px;}
    .cart-item{border:1px solid #e2e8f0;border-radius:14px;padding:14px 16px;background:#f8fafc;display:flex;flex-direction:column;gap:10px;}
    .cart-item-title{font-weight:600;font-size:16px;color:#0f172a;}
    .cart-item-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .cart-item-actions input[type="number"], .cart-item-actions select{padding:10px 12px;border-radius:10px;border:1px solid #cbd5f5;font-size:15px;outline:none;}
    .cart-item-actions select{background:#fff;}
    .cart-item-actions input[type="number"]:focus, .cart-item-actions select:focus{border-color:var(--primary-2);box-shadow:0 0 0 4px var(--ring);}
    .cart-remove{background:none;border:0;color:#ef4444;font-weight:600;cursor:pointer;padding:6px 10px;border-radius:8px;}
    .cart-remove:hover{background:rgba(239,68,68,0.12);}
    .cart-empty{padding:20px;border:1px dashed #cbd5e1;border-radius:14px;text-align:center;color:#475569;background:#fff;}
    .modal-footer{padding:18px 24px;border-top:1px solid #e2e8f0;display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end;}
    .btn-secondary{background:#fff;color:#0f172a;border:1px solid #cbd5f5;box-shadow:none;}
    .btn-secondary:hover{filter:none;background:#f1f5f9;}
    @media(max-width:600px){
      .modal-card{max-width:100%;border-radius:16px;}
      .modal-header, .modal-body, .modal-footer{padding-left:18px;padding-right:18px;}
    }
  </style>
</head>
<body>
  <header><div class="brand"><span class="logo"></span><span>Biovetfarma · Consulta de Ativos</span></div>
    <button id="toggleCart" class="cart-trigger btn-ghost" type="button">Abrir prescrição <span id="cartCount" class="badge">0</span></button></header>
  <main class="container">
    <section class="search-card"><form id="searchForm" class="search-row" autocomplete="off">
      <input id="q" type="search" placeholder="Pesquise um ativo (ex.: Cardo mariano, Silimarina)" />
      <button class="btn" type="submit">Pesquisar</button></form>
      <div class="hint">Dica: digite <span class="kbd">cardo mariano</span> ou <span class="kbd">silimarina</span>.</div>
    </section>
    <section id="results" class="results"></section>
    <div class="empty" id="emptyState">Nenhum resultado ainda. Faça uma busca acima.</div>
  </main>
  <div id="cartModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="cartTitle">Prescrição</h2>
        <button id="closeCart" class="modal-close" type="button">Fechar</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="tutorNome">Tutor</label>
          <input id="tutorNome" type="text" placeholder="Nome do tutor" />
        </div>
        <div>
          <label for="pacienteNome">Paciente</label>
          <input id="pacienteNome" type="text" placeholder="Nome do paciente" />
        </div>
        <div id="cartItems" class="cart-items"></div>
      </div>
      <div class="modal-footer">
        <button id="clearCart" class="btn btn-secondary" type="button">Limpar todos</button>
        <button id="finalizeCart" class="btn" type="button">Prescrever agora</button>
      </div>
    </div>
  </div>
  <footer>© Biovetfarma — protótipo para prescrição veterinária.</footer>
  <script>
    const ATIVOS=[{nomes:["cardo mariano","silimarina"],titulo:"Cardo mariano (Silimarina)",
      indicacoes:["Tratamento adjuvante de doenças hepáticas ou reações hepatotóxicas.","Indicado em situações de sobrecarga hepática."],
      efeitos:["Não apresenta efeitos adversos."],dose:{minMgKg:20,maxMgKg:50}}];
    const DOSE_UNIDADES=["MG","MCG","G","%","MG/ML"];
    const form=document.getElementById('searchForm'),input=document.getElementById('q'),results=document.getElementById('results'),empty=document.getElementById('emptyState');
    const cartState={items:[]};
    const cartModal=document.getElementById('cartModal');
    const openCartBtn=document.getElementById('toggleCart');
    const closeCartBtn=document.getElementById('closeCart');
    const cartCount=document.getElementById('cartCount');
    const cartItemsContainer=document.getElementById('cartItems');
    const clearCartBtn=document.getElementById('clearCart');
    const finalizeCartBtn=document.getElementById('finalizeCart');
    const tutorInput=document.getElementById('tutorNome');
    const pacienteInput=document.getElementById('pacienteNome');

    form.addEventListener('submit',e=>{e.preventDefault();const q=input.value.trim().toLowerCase();if(!q){results.innerHTML="";empty.style.display="block";return;}
      const match=ATIVOS.find(a=>a.nomes.some(n=>n.includes(q)||q.includes(n)));if(match){renderAtivo(match);empty.style.display="none";}else{results.innerHTML=`<div class="drug-card"><div class="pill">Ativo não encontrado</div><h1>Nenhum resultado para “${input.value}”.</h1><p>Experimente: <strong>Cardo mariano</strong> ou <strong>Silimarina</strong>.</p></div>`;empty.style.display="none";}});

    const generateId=()=>`${Date.now()}-${Math.random().toString(16).slice(2)}`;

    function openCart(){cartModal.classList.add('open');}
    function closeCart(){cartModal.classList.remove('open');}

    openCartBtn.addEventListener('click',openCart);
    closeCartBtn.addEventListener('click',closeCart);
    cartModal.addEventListener('click',e=>{if(e.target===cartModal){closeCart();}});

    clearCartBtn.addEventListener('click',()=>{
      if(!cartState.items.length)return;
      cartState.items=[];
      renderCart();
    });
    finalizeCartBtn.addEventListener('click',()=>{
      if(!cartState.items.length){openCart();return;}
      const itemElements=[...cartItemsContainer.querySelectorAll('.cart-item')];
      let hasError=false;
      itemElements.forEach(el=>{
        const id=el.dataset.id;
        const doseInput=el.querySelector('input[data-field="dose"]');
        const unidadeSelect=el.querySelector('select[data-field="unit"]');
        const doseRaw=doseInput.value.trim();
        const parsed=parseFloat(doseRaw);
        if(!doseRaw||isNaN(parsed)||parsed<=0){
          doseInput.classList.add('input-error');
          hasError=true;
          return;
        }
        doseInput.classList.remove('input-error');
        const target=cartState.items.find(item=>item.id===id);
        if(target){
          target.dose=doseRaw;
          target.unidade=unidadeSelect.value;
        }
      });
      if(hasError){
        openCart();
        return;
      }
      generatePrescriptionPdf({
        tutor:tutorInput.value.trim(),
        paciente:pacienteInput.value.trim(),
        itens:cartState.items
      });
      cartState.items=[];
      tutorInput.value='';
      pacienteInput.value='';
      renderCart();
      closeCart();
    });

    function renderCart(){
      cartCount.textContent=cartState.items.length;
      if(!cartState.items.length){
        cartItemsContainer.innerHTML='<div class="cart-empty">Nenhum ativo selecionado. Utilize o botão “Prescrever” para adicionar itens.</div>';
        clearCartBtn.disabled=true;
        finalizeCartBtn.disabled=true;
        return;
      }
      clearCartBtn.disabled=false;
      finalizeCartBtn.disabled=false;
      cartItemsContainer.innerHTML=cartState.items.map(item=>`
        <div class="cart-item" data-id="${item.id}">
          <div class="cart-item-title">${item.titulo}</div>
          <div class="cart-item-actions">
            <input type="number" min="0" step="0.1" value="${item.dose ?? ''}" data-field="dose" aria-label="Dosagem">
            <select data-field="unit" aria-label="Unidade">
              ${DOSE_UNIDADES.map(u=>`<option value="${u}" ${item.unidade===u?'selected':''}>${u}</option>`).join('')}
            </select>
            <button type="button" class="cart-remove" data-action="remove">Excluir</button>
          </div>
        </div>`).join('');

      cartItemsContainer.querySelectorAll('[data-action="remove"]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const id=btn.closest('.cart-item').dataset.id;
          cartState.items=cartState.items.filter(item=>item.id!==id);
          renderCart();
        });
      });

      cartItemsContainer.querySelectorAll('input[data-field="dose"]').forEach(inp=>{
        inp.addEventListener('input',()=>{
          const id=inp.closest('.cart-item').dataset.id;
          const target=cartState.items.find(item=>item.id===id);
          if(!target)return;
          target.dose=inp.value.trim();
          inp.classList.remove('input-error');
        });
      });

      cartItemsContainer.querySelectorAll('select[data-field="unit"]').forEach(sel=>{
        sel.addEventListener('change',()=>{
          const id=sel.closest('.cart-item').dataset.id;
          const target=cartState.items.find(item=>item.id===id);
          if(!target)return;
          target.unidade=sel.value;
        });
      });
    }

    function addToCart(ativo,dose,unidade){
      cartState.items.push({id:generateId(),titulo:ativo.titulo,dose,unidade});
      renderCart();
    }

    function renderAtivo(a){results.innerHTML=`<article class="drug-card"><div class="pill">Hepatoprotetor</div><h1>${a.titulo}</h1>
      <div class="grid grid-2"><section><h2>Indicações e contraindicações</h2><h3>Indicações</h3><ul>${a.indicacoes.map(i=>`<li>${i}</li>`).join('')}</ul>
      <h3>Efeitos adversos</h3><ul>${a.efeitos.map(i=>`<li>${i}</li>`).join('')}</ul></section><section><h2>Dosagem para Cães e Gatos</h2>
      <div class="calc"><div class="row" style="justify-content:space-between"><label><strong>Recomendado:</strong> ${a.dose.minMgKg}–${a.dose.maxMgKg} mg/kg</label>
      <div class="actions" style="gap:10px"><input id="peso" type="number" min="0" step="0.1" placeholder="Peso (kg)">
        <div class="dose-input"><input id="dosePrescricao" type="number" min="0" step="0.1" placeholder="Dose">
        <select id="doseUnidade">${DOSE_UNIDADES.map(u=>`<option value="${u}">${u}</option>`).join('')}</select></div>
        <button class="btn" id="btnPrescrever" type="button">Prescrever</button></div></div>
      <div class="dose" id="doseBox">Informe o peso para calcular a dose.</div><div class="callout"><strong>Atenção:</strong> cálculo automático. Decisão final cabe ao prescritor.</div></div></section></div></article>`;
      const pesoInput=document.getElementById('peso'),doseBox=document.getElementById('doseBox');
      const dosePrescricao=document.getElementById('dosePrescricao');
      const doseUnidade=document.getElementById('doseUnidade');
      const btnPrescrever=document.getElementById('btnPrescrever');

      pesoInput.addEventListener('input',()=>{const kg=parseFloat(pesoInput.value);
        if(isNaN(kg)||kg<=0){doseBox.textContent="Informe o peso.";return;}const min=kg*a.dose.minMgKg,max=kg*a.dose.maxMgKg;doseBox.innerHTML=`Para <strong>${kg.toFixed(2)} kg</strong>:<br>• Dose mínima: <strong>${min.toFixed(1)} mg</strong><br>• Dose máxima: <strong>${max.toFixed(1)} mg</strong>`;});

      dosePrescricao.addEventListener('input',()=>dosePrescricao.classList.remove('input-error'));

      btnPrescrever.addEventListener('click',()=>{
        const doseValor=parseFloat(dosePrescricao.value);
        if(isNaN(doseValor)||doseValor<=0){dosePrescricao.classList.add('input-error');dosePrescricao.focus();return;}
        dosePrescricao.classList.remove('input-error');
        addToCart(a,dosePrescricao.value.trim(),doseUnidade.value);
        openCart();
      });
    }

    renderCart();

    function generatePrescriptionPdf({tutor,paciente,itens}){
      const dataAtual=new Date();
      const dataFormatada=dataAtual.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'});
      const horaFormatada=dataAtual.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
      const linhas=itens.map((item,idx)=>`
        <tr>
          <td>${idx+1}</td>
          <td>${item.titulo}</td>
          <td>${item.dose} ${item.unidade}</td>
        </tr>`).join('');
      const documento=`<!doctype html><html lang="pt-BR"><head><meta charset="utf-8" />
        <title>Prescrição digital</title>
        <style>
          *{box-sizing:border-box;font-family:'Segoe UI',Arial,sans-serif;color:#0f172a;}
          body{margin:0;padding:40px;background:#eef4f7;}
          .sheet{max-width:720px;margin:0 auto;background:#fff;border-radius:20px;padding:36px 44px;box-shadow:0 20px 60px rgba(15,23,42,0.12);border:1px solid #e2e8f0;}
          header{text-align:center;margin-bottom:30px;}
          header h1{margin:0;font-size:24px;color:#13696d;letter-spacing:0.04em;text-transform:uppercase;}
          header p{margin:6px 0 0;font-size:14px;color:#475569;}
          .meta{display:flex;flex-direction:column;gap:12px;margin-bottom:28px;padding:16px 18px;border:1px solid #d6e2ea;border-radius:14px;background:linear-gradient(120deg,#f8fbfd,#ffffff);}
          .meta div{display:flex;gap:12px;font-size:15px;}
          .meta span:first-child{width:90px;font-weight:600;color:#0b3b3d;text-transform:uppercase;font-size:13px;letter-spacing:0.02em;}
          table{width:100%;border-collapse:collapse;margin-bottom:28px;}
          thead th{text-align:left;font-size:13px;color:#475569;font-weight:600;padding-bottom:10px;border-bottom:2px solid #cbd5e1;text-transform:uppercase;letter-spacing:0.05em;}
          tbody td{padding:12px 0;border-bottom:1px solid #e2e8f0;font-size:15px;}
          tbody tr:last-child td{border-bottom:none;}
          .observacao{padding:16px;border:1px dashed #cbd5e1;border-radius:12px;font-size:14px;color:#475569;background:#f8fafc;}
          footer{margin-top:32px;text-align:right;font-size:13px;color:#64748b;}
          @media print{body{background:#fff;} .sheet{box-shadow:none;border:none;margin:0;}}
        </style>
      </head><body>
        <div class="sheet">
          <header>
            <h1>Receita Digital</h1>
            <p>Biovetfarma · Prescrição veterinária</p>
          </header>
          <section class="meta">
            <div><span>Tutor</span><strong>${tutor||'—'}</strong></div>
            <div><span>Paciente</span><strong>${paciente||'—'}</strong></div>
            <div><span>Data</span><strong>${dataFormatada} às ${horaFormatada}</strong></div>
          </section>
          <table>
            <thead>
              <tr><th>#</th><th>Ativo</th><th>Dosagem</th></tr>
            </thead>
            <tbody>${linhas}</tbody>
          </table>
          <div class="observacao">
            Esta receita digital é válida exclusivamente para uso interno de avaliação clínica. Assinatura eletrônica requerida para emissão oficial.
          </div>
          <footer>Emitido automaticamente em ${dataFormatada}.</footer>
        </div>
        <script>window.addEventListener('load',()=>{setTimeout(()=>{window.print();},200);});</script>
      </body></html>`;
      const popup=window.open('','_blank','noopener');
      if(!popup){alert('Não foi possível abrir a prescrição. Verifique o bloqueador de pop-ups.');return;}
      popup.document.write(documento);
      popup.document.close();
      popup.focus();
    }
  </script>
</body>
</html>
